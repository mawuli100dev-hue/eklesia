generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


enum AuthProvider {
  CREDENTIALS
  GOOGLE
}

enum Role {
  USER
  ADMIN
}

model User {
  id             Int       @id @default(autoincrement())
  name          String
  email          String    @unique
  password       String?   // nullable because Google users may not have one
  language       String?
  role           Role     @default(USER)
  provider       AuthProvider @default(CREDENTIALS)
  googleId     String?   @unique // ID from Google or another provider (e.g., Google user ID)

  // Relations
  events         Event[]   @relation("UserEvents")
  forums         Forum[]   @relation("ForumMembers")
  messages       Message[]
  favoriteBibleReadings FavoriteBibleReading[]
}

model Event {
  id          Int       @id @default(autoincrement())
  title       String
  description String
  date        DateTime
  location    String
  language    String

  // Relations
  users     User[]     @relation("UserEvents")
  messages  Message[]
}

model Forum {
  id      Int     @id @default(autoincrement())
  name    String
  type    String

  // Relations
  members   User[]    @relation("ForumMembers")
  messages  Message[]
}

model Message {
  id          Int       @id @default(autoincrement())
  content     String
  timestamp   DateTime  @default(now())

  // Relations
  eventId     Int?
  event       Event?     @relation(fields: [eventId], references: [id])

  forumId     Int?
  forum       Forum?     @relation(fields: [forumId], references: [id])

  userId      Int?
  user        User?      @relation(fields: [userId], references: [id])
}

model BibleReading {
  id          Int       @id @default(autoincrement())
  date        DateTime  @default(now())
  theme       String
  description String
  language    String

  // Relations
  texts     BibleText[]
  favoriteBibleReadings FavoriteBibleReading[]

  // Constraints
  @@unique([date, language])
}

model FavoriteBibleReading {
  id          Int       @id @default(autoincrement())
  userId      Int
  user        User     @relation(fields: [userId], references: [id])

  bibleReadingId Int
  bibleReading BibleReading @relation(fields: [bibleReadingId], references: [id])
  createdAt   DateTime  @default(now())
}

model BibleText {
  id               Int            @id @default(autoincrement())
  reference        String
  content          String?
  language         String

  // Relations
  readingId        Int?
  bibleReading     BibleReading? @relation(fields: [readingId], references: [id])
}

model Media {
  id          Int     @id @default(autoincrement())
  type        String
  url         String
  title       String
  description String
}